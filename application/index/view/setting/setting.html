<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <script src="__JS_PATH__/jquery-1.8.3.js"></script>
        <script src="__JS_PATH__/jquery.reveal.js"></script>
        <script src="__JS_PATH__/jquery.cookie.js"></script>
        <link rel="icon" href="/static/img/logo-50-50.jpg" type="image/x-icon" /> 
        <!--[if lte IE 10]>
        <script src="__JS_PATH__/requestanimationframe.js"></script>
        <![endif]-->
        <link rel=stylesheet href="__CSS_PATH__/reset.css">
        <link rel=stylesheet href="__CSS_PATH__/common.css">
        <link rel=stylesheet href="__CSS_PATH__/base.css">
        <link rel=stylesheet href="__CSS_PATH__/account.css">
        <link rel=stylesheet href="__CSS_PATH__/header.css">
        <link rel=stylesheet href="__CSS_PATH__/reveal.css">
        <link rel=stylesheet href="__CSS_PATH__/login.css">
        <link rel=stylesheet href="__CSS_PATH__/menu02.css">
        <link rel=stylesheet href="__CSS_PATH__/order.css">
        <link rel=stylesheet href="__CSS_PATH__/footer_2.css">
        <link rel=stylesheet href="__CSS_PATH__/form.css"> 
        <title>订饭组</title>
    </head>
    <body>
        <!--header部分-->
        <div class="header shadow">
            <div class="search-result"> 
            </div>
            <div class="header-left fl">
                <div class="icon fl"></div>
                <a class="weixin-dingfan fw" href="#">微信订饭</a>
                <a class="logo" href="/"></a>
                <div class="search">
                <img class="search-icon" src="__IMG_PATH__/icon_search.png" width="22" height="22">
                <input id="search-input" class="search-input" type="text" placeholder="请输入楼名" onkeypress="onKeySearch()">
                <span id="search-del" class="search-del">&times;</span> 
                </div>
                <div class="clear"></div>
            </div>
            <div class="header-right fr">
                <div class="login fl">

                   <span class="header-operater">
                    <a href="/index/Shop/shop_list">外卖</a>
                    <a id="order" href="/index/OrderList/order">我的订单</a>
                    <a href="/index/About/enter">商家入驻</a>
                    <a id="houtai" href="/admin/login/login">后台管理</a> 
                    </span> 
                    <a id="header-login" class="navBtn f-radius f-select" data-reveal-id="myModal" data-animation="fade">
                    登录
                    </a>
                    <a id="header-user"></a>
                </div>

                 <!-- 后台入口显示 -->
                <script>
                    var username = $.cookie('userId');
                    if(!username)
                    {
                        $('#houtai').hide();
                    }else{
                        $.post(
                            '/index/User/hou_tai',
                            {username:username},
                            function(data){
                                $res = $.parseJSON(data);
                                if($res.status == 'success'){
                                  if($res.code == 0){
                                    $('#houtai').show();
                                 }else{
                                    $('#houtai').hide();
                                 }

                                }else{
                                    showAlert("服务器异常");
                                }
                                
                            }
                        );
                    }
                </script>
                <!-- <div id="cart" class="cart fr"> 
                    <img class="cart-icon" src="__IMG_PATH__/icon_cart_22_22.png">
                </div> -->
                <div id="user" class="user fr n">
                    <img class="user-icon" src="__IMG_PATH__/icon_my.png"> 
                </div> 
            </div> 
            
             <ul id="subnav" class="subnav subnav-shadow n">
                <li><a href="" target="" id="a6">最新订单</a></li>
                <li><a href="" target="" id="a7">历史订单</a></li>
                <li><a href="" target="" id="a8">我的积分</a></li>
                <li><a href="" target="" id="a9">我的收藏</a></li>
                <li><a href="" target="" id="a10">账户设置</a></li>
                <li><a id="sub-logout" href="" target="">退出</a></li>
            </ul>
        </div>

        <!--------------------------- 购物车展示 -------------------------------->
            <div class="shop-cart shadow n">
                <div class="shop-head">
                    购物车<a class="shop-clear">[清空]</a>
                </div>
                <div class="shop-body">    
                    

                    <div class="isnull">
                        <span></span>
                        <b>购物车空空如也</b>
                    </div>
                </div>
                <div class="shop-bottom">
                    <div class="bottom-price fl">总计：￥<label>32</label>
                    </div>
                    <div class="bottom-icon"></div>
                    <div class="bottom-pay fr">
                        <a id="cart-pay">结算</a>
                    </div>
                </div>
        </div>
<!--------------------------- 购物车展示结束 -------------------------------->

        <!--主体-->
        <div class="content">
            <!--左侧导航-->
            <div class="content-left fl">
                <div class="menu-left">
                    <dl>
                        <dt>个人中心</dt>
                        <dd class="menu-item active">
                            <span class="left-icon">
                                <img src="__IMG_PATH__/icon_order.png" width="18px" height="18px">
                            </span>
                        <a href="" id="a1">最新订单</a>
                        </dd>
                        <dd class="menu-item">
                            <span class="left-icon">
                                <img src="__IMG_PATH__/icon_address.png" width="18px" height="18px">
                            </span>
                        <a href="" id="a2">历史订单</a>
                        </dd> 
                        <dd class="menu-item">
                            <span class="left-icon">
                                <img src="__IMG_PATH__/icon_score.png" width="18px" height="18px">
                            </span>
                        <a href="" id="a3">我的积分</a>
                        </dd>
                        <dd class="menu-item">
                            <span class="left-icon">
                                <img src="__IMG_PATH__/icon_balance.png" width="18px" height="18px">
                            </span>
                        <a href="" id="a4">店铺收藏</a>
                        </dd>
                        <dd class="menu-item ">
                            <span class="left-icon">
                                <img src="__IMG_PATH__/icon_settings.png" width="18px" height="18px">
                            </span>
                        <a href="" id="a5">账户设置</a>
                        </dd>
                    </dl>
                </div>
            </div>
            
            <!-- 赋值href -->
            <script>
                $username = $.cookie('userId');
                $('#order').attr('href', '/index/OrderList/order/username/'+$username);

                $('#a1').attr('href', '/index/OrderList/order/username/'+$username);
                $('#a2').attr('href', '/index/OrderHistory/scan_history/username/'+$username);
                $('#a3').attr('href', '/index/jifen/score/username/'+$username);
                $('#a4').attr('href', '/index/User/collect/username/'+$username);
                $('#a5').attr('href', '/index/Setting/setting/username/'+$username);

                $('#a6').attr('href', '/index/OrderList/order/username/'+$username);
                $('#a7').attr('href', '/index/OrderHistory/scan_history/username/'+$username);
                $('#a8').attr('href', '/index/jifen/score/username/'+$username);
                $('#a9').attr('href', '/index/User/collect/username/'+$username);
                $('#a10').attr('href', '/index/Setting/setting/username/'+$username);
            </script>

            <!--右侧内容-->
            <div class="content-right fl">
                <div class="summary fl">
                    <h3 class="summary-header">账户设置</h3>
                </div>
                <div class="accountform" id="form-settings">
                    <div>
                        <div class="accountformfield">
                            <label>我的饭组：</label> <span id="myFanzu">订饭组&nbsp;</span>
                        </div>
                        <div class="accountformfield">
                            <label>姓名：</label><input id="name" placeholder="请输入您的姓名">
                            <div class="accountformfield-hint form-error">
                                <span id="error-name"></span>
                            </div>
                        </div>
                        <div class="accountformfield phonefield">
                            <label>手机号：</label><span id="pn"></span>
                            <div class="accountformfield-hint">
                                <span></span>
                            </div>
                        </div>  
                        <div class="accountformfield passwordfield">
                            <label>密码：</label><span>*******</span>
                            <button id="btn-update-pwd">修改密码</button>
                            <div class="accountformfield-hint">
                                <span></span>
                            </div>
                        </div> 
                        <!-- <div class="accountformfield emailfield">
                            <label>我的邮箱</label><input id="email" placeholder="请输入邮箱">
                            <div class="accountformfield-hint">
                                <span></span>
                            </div>
                        </div>  -->
                        
                        <!-- 总共多少单，成功多少单 -->
                        <div class="accountformfield">
                            <label>订单信息：</label> 
                            <span id="myFanzu">总计&ensp;<i style="color: red;font-size: 16px">{$res1}</i> &ensp;单</span> &ensp;&ensp;|&ensp;&ensp;
                           <span id="myFanzu">成功&ensp;<i style="color: red;font-size: 16px">{$res2}</i> &ensp;单</span>
                        </div>

                    </div>
                    <div class="accountform-buttons">
                        <a id="save-settings" class="save-btn" href="#">保存</a>
                    </div>
                </div>

                <div class="accountform n" id="form-pwd">
                    <div> 
                        <div class="accountformfield">
                            <label>原密码</label><input id="pwd" placeholder="请输入当前登录密码">
                            <div class="accountformfield-hint form-error">
                                <span id="error-pwd"></span>
                            </div>
                        </div>
                        <div class="accountformfield">
                            <label>新密码</label><input id="pwd2" placeholder="请输入6-18位字母或数字密码">
                            <div class="accountformfield-hint form-error">
                                <span id="error-pwd2"></span>
                            </div>
                        </div>
                        <div class="accountformfield">
                            <label>确认新密码</label><input id="pwd3" placeholder="请再次输入新的密码">
                            <div class="accountformfield-hint form-error">
                                <span id="error-pwd3"></span>
                            </div>
                        </div>
                    </div> 
                    <div class="accountform-buttons">
                        <a id="save-new-pwd" class="save-btn" href="#">修改</a>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
       <div class="footer-content">
              <div class="footer-content-entrance">
                <a class="footer-content-link" href="/index/About/enter">关于我们</a>
                <span class="footer-content-separator">|</span>
                <a class="footer-content-link footer-content-weixing">关注微信
                <img class="weixin-pic" src="__IMG_PATH__/qr_code.jpg">
                </a>
                <span class="footer-content-separator">|</span> 
                <a class="footer-content-link" href="/index/About/enter">投诉建议</a>
                <span class="footer-content-separator">|</span>
                <a class="footer-content-link kaidian_address" href="/index/About/enter">商家入驻</a>

              </div>
              <div class="footer-content-copyright">©2017 订饭组 <a target="_blank">粤ICP备17106509号-1</a> </div>
        </div>

        <!--提示框-->
        <div id="alertModel" class="alertModel" >
        <a id="alert" data-reveal-id="alertModel" data-animation="fade"></a>
        <span id="alert-msg"></span>
        <button id="btn-ok" class="btn">知道了</button>
        <a id="btn-close" class="close-reveal-modal"><img src="__IMG_PATH__/icon_close.png" height="24" width="24"></a>
        </div>

        <script src="__JS_PATH__/common.js"></script>
        <script src="__JS_PATH__/md5.js"></script>
        <script src="__JS_PATH__/login.js"></script>   
        <script src="__JS_PATH__/cart.lib.js"></script>
        <script src="__JS_PATH__/cart.js"></script>
        <script src="__JS_PATH__/header.js"></script>
        <script src="__JS_PATH__/account.js"></script>
        <script src="__JS_PATH__/myinfo.js"></script> 
        <script src="__JS_PATH__/footer.js"></script>

        <script >
        $(function(){ 

        if($.cookie('userId'))
        {
            var userId=$.cookie('userId');
            $('#header-user').html('hi，'+userId);
            $('#header-user').show();
            $('#header-login').hide(); 
            $('#user').show();
        }

            $('#sub-logout').click(function(){
            $.removeCookie('userId',{expires:7,path:'/'});//删除cookie 
            location.href = '/';
        });
    });       
 </script>

        <script>
            $(function(){
                //初始化设置
                initSettings();

                //修改密码
                $("#btn-update-pwd").click(function(event) {
                    $("#form-settings").hide();
                    $("#form-pwd").show();
                });

                //保存设置（未有新项）
                $("#save-settings").click(function(event) {
                    saveSettings();
                });

                //保存新密码
                $("#save-new-pwd").click(function(event) {
                    saveNewPwd();
                });

            });

            function initSettings(){ 
                var userId=$.cookie("userId");
                var name=my_GetValue("name");
                var place=my_GetValue("place");
                var email=my_GetValue("email"); 

                if(place){
                    $("#myFanzu").html(place);
                }
                
                $("#pn").html(userId);
                if(name&&name.length>0){ 
                    $("#name").val(name);
                }
                if(email&&email.length>0){
                    $("#email").val(email); 
                } 
            }

            // 保存设置
            function saveSettings(){
                var username=$.cookie("userId");
                var name=$("#name").val().trim();
                // var email=$("#email").val().trim();
                if(name.length<=0){
                    $("#error-name").html("请输入姓名");
                    return;
                }
                var postUrl="/index/User/real_name";  
                    $.post(postUrl,  
                        {
                            username:username,
                            real_name:name,
                            // email:email
                        },
                        function(data) { 
                         $res= $.parseJSON(data);   
                           if($res.status=="success"){                                  
                                if($res.code=="0"){  
                                    
                                    showAlert("保存成功");

                                }else if($res.code=="1"){
                                    showAlert("未曾改动");
                                } 
                           }else{
                                showAlert("服务器异常,请重试");
                           }
                       });  
            }


            //保存新密码
            function saveNewPwd(){
                var username=$.cookie("userId");
                var pwd=$("#pwd").val().trim();
                var pwd2=$("#pwd2").val().trim();
                var pwd3=$("#pwd3").val().trim();

                $("#error-pwd,#error-pwd2,#error-pwd3").html("");
                if(!/\w{6,18}/.test(pwd)){ 
                    $("#error-pwd").html("请输入6-18位字母或数字密码");
                    return;
                }else if(!/\w{6,18}/.test(pwd2))
                {
                    $('#error-pwd2').html('请输入6-18位字母或数字密码');
                    return;
                }else if(pwd2!=pwd3){
                    $("#error-pwd3").html("两次密码不一致");
                    return;
                }

                var postUrl="/index/User/new_pwd";  
                    $.post(postUrl,  
                        {
                            username:username,
                            password:pwd,
                            password2:pwd2
                        },
                        function(data) {
                           var res= $.parseJSON(data); 
                           if(res.status=="success"){                                     
                                if(res.code=="0"){   
                                    showAlert("修改成功");

                                }else if(res.code=="1"){
                                    showAlert('登录密码有误，请检查');
                                }else if(res.code=='2'){
                                    showAlert('密码未改动');
                                }
                           }else{
                                showAlert("服务器异常,请重试");
                           }
                       });  
            }


       function showAlert(msg,url){ 
        $("#alert").trigger('click');
        $("#alert-msg").html(msg);
         
         if(url){
            $("#btn-ok,#btn-close").click(function(event) {
                window.location.href=url;
            });
         }
        
        }
        </script>


    </body>
</html>